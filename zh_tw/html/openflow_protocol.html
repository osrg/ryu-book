<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_TW">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenFlow 通訊協定 &#8212; Ryubook 1.0 說明文件</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜尋" href="search.html" />
    <link rel="top" title="Ryubook 1.0 說明文件" href="index.html" />
    <link rel="next" title="ofproto 函式庫" href="ofproto_lib.html" />
    <link rel="prev" title="生成樹（ Spanning Tree ）" href="spanning_tree.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="總索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="ofproto_lib.html" title="ofproto 函式庫"
             accesskey="N">下一頁</a> |</li>
        <li class="right" >
          <a href="spanning_tree.html" title="生成樹（ Spanning Tree ）"
             accesskey="P">上一頁</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 說明文件</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="openflow">
<span id="ch-openflow-protocol"></span><h1>OpenFlow 通訊協定<a class="headerlink" href="#openflow" title="本標題的永久連結">¶</a></h1>
<p>本章將描述 Match、Instructions 和 Action 在 OpenFlow 協定中的細節。</p>
<div class="section" id="match">
<h2>Match<a class="headerlink" href="#match" title="本標題的永久連結">¶</a></h2>
<p>有許多種類的指定條件可以用在 Match ，隨著 OpenFlow 版本的持續更新，數量也在持續增加中。
在 OpenFlow 1.0 時僅有 12 種，OpenFlow 1.3 時數量就來到約 40 種。</p>
<p>若想要了解每個指令的細節，請參考 OpenFlow 規格書。本章僅簡要列出 OpenFlow 1.3 的 Match 指令。</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Match Field 名稱</th>
<th class="head">說明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>in_port</td>
<td>接受埠編號(含邏輯埠)</td>
</tr>
<tr class="row-odd"><td>in_phy_port</td>
<td>接收埠實體編號</td>
</tr>
<tr class="row-even"><td>metadata</td>
<td>在 table 間傳遞使用的 Metadata</td>
</tr>
<tr class="row-odd"><td>eth_src</td>
<td>Ethernet MAC 來源位址</td>
</tr>
<tr class="row-even"><td>eth_dst</td>
<td>Ethernet MAC 目的位址</td>
</tr>
<tr class="row-odd"><td>eth_type</td>
<td>Ethernet 訊框種類</td>
</tr>
<tr class="row-even"><td>vlan_vid</td>
<td>VLAN ID</td>
</tr>
<tr class="row-odd"><td>vlan_pcp</td>
<td>VLAN PCP</td>
</tr>
<tr class="row-even"><td>ip_dscp</td>
<td>IP DSCP</td>
</tr>
<tr class="row-odd"><td>ip_ecn</td>
<td>IP ECN</td>
</tr>
<tr class="row-even"><td>ip_proto</td>
<td>IP 協定種類</td>
</tr>
<tr class="row-odd"><td>ipv4_src</td>
<td>IPv4 IP 來源位址</td>
</tr>
<tr class="row-even"><td>ipv4_dst</td>
<td>IPv4 IP 目的位址</td>
</tr>
<tr class="row-odd"><td>tcp_src</td>
<td>TCP port 來源編號</td>
</tr>
<tr class="row-even"><td>tcp_dst</td>
<td>TCP port 目的編號</td>
</tr>
<tr class="row-odd"><td>udp_src</td>
<td>UDP port 來源編號</td>
</tr>
<tr class="row-even"><td>udp_dst</td>
<td>UDP port 目的編號</td>
</tr>
<tr class="row-odd"><td>sctp_src</td>
<td>SCTP port 來源編號</td>
</tr>
<tr class="row-even"><td>sctp_dst</td>
<td>SCTP port 目的編號</td>
</tr>
<tr class="row-odd"><td>icmpv4_type</td>
<td>ICMP 種類</td>
</tr>
<tr class="row-even"><td>icmpv4_code</td>
<td>ICMP Code 編碼</td>
</tr>
<tr class="row-odd"><td>arp_op</td>
<td>ARP Opcode</td>
</tr>
<tr class="row-even"><td>arp_spa</td>
<td>ARP IP 來源位址</td>
</tr>
<tr class="row-odd"><td>arp_tpa</td>
<td>ARP IP 目的位址</td>
</tr>
<tr class="row-even"><td>arp_sha</td>
<td>ARP MAC 來源位址</td>
</tr>
<tr class="row-odd"><td>arp_tha</td>
<td>ARP MAC 目的位址</td>
</tr>
<tr class="row-even"><td>ipv6_src</td>
<td>IPv6 IP 來源位址</td>
</tr>
<tr class="row-odd"><td>ipv6_dst</td>
<td>IPv6 IP 目的位址</td>
</tr>
<tr class="row-even"><td>ipv6_flabel</td>
<td>IPv6 Flow label</td>
</tr>
<tr class="row-odd"><td>icmpv6_type</td>
<td>ICMPv6 Type</td>
</tr>
<tr class="row-even"><td>icmpv6_code</td>
<td>ICMPv6 Code</td>
</tr>
<tr class="row-odd"><td>ipv6_nd_target</td>
<td>IPv6 neighbour discovery 目的位址</td>
</tr>
<tr class="row-even"><td>ipv6_nd_sll</td>
<td>IPv6 neighbour discovery link-layer 來源位址</td>
</tr>
<tr class="row-odd"><td>ipv6_nd_tll</td>
<td>IPv6 neighbour discovery link-layer 目的位址</td>
</tr>
<tr class="row-even"><td>mpls_label</td>
<td>MPLS 標簽</td>
</tr>
<tr class="row-odd"><td>mpls_tc</td>
<td>MPLS Traffic class(TC)</td>
</tr>
<tr class="row-even"><td>mpls_bos</td>
<td>MPLS Bos bit</td>
</tr>
<tr class="row-odd"><td>pbb_isid</td>
<td>802.1ah PBB I-SID</td>
</tr>
<tr class="row-even"><td>tunnel_id</td>
<td>邏輯埠的 metadata</td>
</tr>
<tr class="row-odd"><td>ipv6_exthdr</td>
<td>IPv6 extension header 的 Pseudo-field</td>
</tr>
</tbody>
</table>
<p>可以針對 MAC 位址或 IP 位址，透過 Mask 來指定 field。</p>
</div>
<div class="section" id="instruction">
<h2>Instruction<a class="headerlink" href="#instruction" title="本標題的永久連結">¶</a></h2>
<p>Instruction 是用來定義當封包滿足所規範的 Match 條件時，需要執行的動作。
下面列出相關的定義。</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Instruction</th>
<th class="head">說明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Goto Table(必要)</td>
<td>在 OpenFlow 1.1 或更新的版本中， multiple flow tables
將是必需支援的項目。透過 Goto Table 的指令可以在多個 table
間進行移轉，並繼續相關的比對及對應的動作。
例如：「收到來自 port 1 的封包時，增加 VLAN-ID 200 的 tag
，並移動至 table 2」。
而所指定的 table ID 則必須是大於目前的 table ID。</td>
</tr>
<tr class="row-odd"><td>Write Metadata(選項)</td>
<td>寫入 Metadata 以做為下一個 table 所需的參考資料。</td>
</tr>
<tr class="row-even"><td>Write Actions(必要)</td>
<td>在目前的 action set 中寫入新的 action ，如果有相同的 action 存在時
，會進行覆蓋。</td>
</tr>
<tr class="row-odd"><td>Apply Actions(選項)</td>
<td>立刻執行所指定的 action 不對現有的 action set 進行修改。</td>
</tr>
<tr class="row-even"><td>Clear Actions(選項)</td>
<td>清空目前存在 action set 中的資料。</td>
</tr>
<tr class="row-odd"><td>Meter(選項)</td>
<td>指定該封包到所定義的 meter table。</td>
</tr>
</tbody>
</table>
<p>以下的類別是對應各個 Instruction 的 Ryu 實作。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">OFPInstructionGotoTable</span></code></li>
<li><code class="docutils literal"><span class="pre">OFPInstructionWriteMetadata</span></code></li>
<li><code class="docutils literal"><span class="pre">OFPInstructionActions</span></code></li>
<li><code class="docutils literal"><span class="pre">OFPInstructionMeter</span></code></li>
</ul>
<p>Write/Apply/Clear Actions 已經包含在 OPFInstructionActions 中，可以在安裝的時候進行選取。</p>
<div class="admonition note">
<p class="first admonition-title">備註</p>
<p class="last">Write Actions 雖然在規格中被列為必要，但是目前的 Open vSwitch 並不支援該功能。
Apply Actions 是目前 Open vSwitch 所提供的功能，所以可以用來替代 Write Actions。
Write Actions 預計在 Open vSwitch 2.1.0 中支援。</p>
</div>
</div>
<div class="section" id="action">
<h2>Action<a class="headerlink" href="#action" title="本標題的永久連結">¶</a></h2>
<p>OFPActionOutput Class 是用來轉送指定封包，其中包含 Packet-Out 和 Flow Mod。
設定好要傳送的最大封包容量（max_len）和要傳送的 Controller 目的地做為 Constructor 的參數。
對於設定目的地，除了實體連接埠號之外還有一些其他的值可以進行定義。</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">名稱</th>
<th class="head">說明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>OFPP_IN_PORT</td>
<td>轉送到接收埠</td>
</tr>
<tr class="row-odd"><td>OFPP_TABLE</td>
<td>轉送到最前端的 table</td>
</tr>
<tr class="row-even"><td>OFPP_NORMAL</td>
<td>使用交換器本身的 L2 / L3 功能轉送</td>
</tr>
<tr class="row-odd"><td>OFPP_FLOOD</td>
<td>轉送（Flood）到所有 VLAN 的物理連接埠，除了來源埠跟已閉鎖的埠之外</td>
</tr>
<tr class="row-even"><td>OFPP_ALL</td>
<td>轉送到除了來源埠之外的所有埠</td>
</tr>
<tr class="row-odd"><td>OFPP_CONTROLLER</td>
<td>轉送到 Controller 的 Packet-In 訊息</td>
</tr>
<tr class="row-even"><td>OFPP_LOCAL</td>
<td>轉送到交換器本身（local port）</td>
</tr>
<tr class="row-odd"><td>OFPP_ANY</td>
<td>使用 Wild card 來指定 Flow Mod（delete）或 Flow Stats Requests 訊息的埠號，
主要功能並不是用來轉送封包訊息。</td>
</tr>
</tbody>
</table>
<p>當指定 max_len 為 0 時，Binary data 將不會被加在 Packet-In 的訊息中。
當 <code class="docutils literal"><span class="pre">OFPCML_NO_BUFFER</span></code> 被指定時，所有的封包將會加入 Packet-In 訊息中而不會暫存在 OpenFlow 交換器。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">目錄</a></h3>
  <ul>
<li><a class="reference internal" href="#">OpenFlow 通訊協定</a><ul>
<li><a class="reference internal" href="#match">Match</a></li>
<li><a class="reference internal" href="#instruction">Instruction</a></li>
<li><a class="reference internal" href="#action">Action</a></li>
</ul>
</li>
</ul>

  <h4>上一個主題</h4>
  <p class="topless"><a href="spanning_tree.html"
                        title="上一章">生成樹（ Spanning Tree ）</a></p>
  <h4>下一個主題</h4>
  <p class="topless"><a href="ofproto_lib.html"
                        title="下一章">ofproto 函式庫</a></p>
  <div role="note" aria-label="source link">
    <h3>本頁</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/openflow_protocol.txt"
            rel="nofollow">顯示原始碼</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜尋</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="前往" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>瀏覽</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="總索引"
             >索引</a></li>
        <li class="right" >
          <a href="ofproto_lib.html" title="ofproto 函式庫"
             >下一頁</a> |</li>
        <li class="right" >
          <a href="spanning_tree.html" title="生成樹（ Spanning Tree ）"
             >上一頁</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 說明文件</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, RYU project team.
      使用 <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8 創建。
    </div>
  </body>
</html>