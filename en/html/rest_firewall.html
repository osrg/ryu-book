<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Firewall &mdash; Ryubook 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ryubook 1.0 documentation" href="index.html" />
    <link rel="next" title="Router" href="rest_router.html" />
    <link rel="prev" title="OF-Config Library" href="of_config.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rest_router.html" title="Router"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="of_config.html" title="OF-Config Library"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="firewall">
<span id="ch-rest-firewall"></span><h1>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to use Firewall, which can be set using REST.</p>
<div class="section" id="example-of-operation-of-a-single-tenant-ipv4">
<h2>Example of operation of a single tenant (IPv4)<a class="headerlink" href="#example-of-operation-of-a-single-tenant-ipv4" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating a topology such as the following and adding or deleting a route or address for switch s1.</p>
<a class="reference internal image-reference" href="_images/fig13.png"><img alt="_images/fig13.png" class="align-center" src="_images/fig13.png" style="width: 405.6px; height: 295.2px;" /></a>
<div class="section" id="environment-building">
<h3>Environment Building<a class="headerlink" href="#environment-building" title="Permalink to this headline">¶</a></h3>
<p>First, build an environment on Mininet. The commands to be entered are the same as &#8220;<a class="reference internal" href="switching_hub.html#ch-switching-hub"><span class="std std-ref">Switching Hub</span></a>&#8220;</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span>ryu@ryu-vm:~$ sudo mn --topo single,3 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1 h2 h3
*** Adding switches:
s1
*** Adding links:
(h1, s1) (h2, s1) (h3, s1)
*** Configuring hosts
h1 h2 h3
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 1 switches
s1

*** Starting CLI:
mininet&gt;
</pre></div>
</div>
<p>Also, start another xterm for the controller.</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">mininet</span><span class="o">&gt;</span> <span class="n">xterm</span> <span class="n">c0</span>
<span class="n">mininet</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-vsctl set Bridge s1 protocols=OpenFlow13</span>
</pre></div>
</div>
<p>Finally, start rest_firewall on xterm of the controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ryu-manager ryu.app.rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="kc">None</span> <span class="n">of</span> <span class="n">DPSet</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">dpset</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">wsgi</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span> <span class="n">of</span> <span class="n">RestFirewallAPI</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span> <span class="n">of</span> <span class="n">OFPHandler</span>
<span class="p">(</span><span class="mi">2210</span><span class="p">)</span> <span class="n">wsgi</span> <span class="n">starting</span> <span class="n">up</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">switch_id</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Join</span> <span class="k">as</span> <span class="n">firewall</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-in-the-initial-state">
<h3>Changing in the initial state<a class="headerlink" href="#changing-in-the-initial-state" title="Permalink to this headline">¶</a></h3>
<p>Immediately after starting the firewall, it was set to disable status to cut off all communication. Enable it with the following command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For details of REST API used in the following description, please see &#8220;<a class="reference internal" href="#rest-api-list">REST API List</a>&#8221; at the end of the section.</p>
</div>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X PUT http://localhost:8080/firewall/module/enable/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall running.&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/module/status</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The result of the REST command is formatted for easy viewing.</p>
</div>
<p>Check ping communication from h1 to h2. Since access permission rules are not set, communication will be blocked.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.2</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">20</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">0</span> <span class="n">received</span><span class="p">,</span> <span class="mi">100</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">19003</span><span class="n">ms</span>
</pre></div>
</div>
<p>Packets that are blocked are output to the log.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:02&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:01&#39;</span><span class="p">),</span> <span class="n">ipv4</span><span class="p">(</span><span class="n">csum</span><span class="o">=</span><span class="mi">9895</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;10.0.0.2&#39;</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">header_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">identification</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">proto</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;10.0.0.1&#39;</span><span class="p">,</span><span class="n">tos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">total_length</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span><span class="n">ttl</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">icmp</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">55644</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">echo</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;K</span><span class="se">\x8e\xae</span><span class="s1">R</span><span class="se">\x00\x00\x00\x00</span><span class="s1">=</span><span class="se">\xc6\r\x00\x00\x00\x00\x00\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class="s1"> !&quot;#$%&amp;</span><span class="se">\&#39;</span><span class="s1">()*+,-./01234567&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">6952</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="nb">type</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-rule">
<h3>Adding a Rule<a class="headerlink" href="#adding-a-rule" title="Permalink to this headline">¶</a></h3>
<p>Add a rule to permit pinging between h1 and h2. You need to add the rule for both ways.</p>
<p>Let&#8217;s add the following rules. Rule ID is assigned automatically.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10.0.0.1/32</td>
<td>10.0.0.2/32</td>
<td>ICMP</td>
<td>Allow</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>10.0.0.2/32</td>
<td>10.0.0.1/32</td>
<td>ICMP</td>
<td>Allow</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_src&quot;: &quot;10.0.0.1/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.2/32&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=1&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_src&quot;: &quot;10.0.0.2/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.1/32&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=2&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Added rules are registered in the switch as flow entries.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-ofctl -O openflow13 dump-flows s1</span>
<span class="n">OFPST_FLOW</span> <span class="n">reply</span> <span class="p">(</span><span class="n">OF1</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">xid</span><span class="o">=</span><span class="mh">0x2</span><span class="p">):</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">823.705</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">420</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">65534</span><span class="p">,</span><span class="n">arp</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">542.472</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">1960</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span> <span class="n">actions</span><span class="o">=</span><span class="n">CONTROLLER</span><span class="p">:</span><span class="mi">128</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">145.05</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">118.265</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
</pre></div>
</div>
<p>In addition, add a rule to allow all IPv4 packets, including ping, between h3 and h2.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="19%" />
<col width="19%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10.0.0.2/32</td>
<td>10.0.0.3/32</td>
<td>any</td>
<td>Allow</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>10.0.0.3/32</td>
<td>10.0.0.2/32</td>
<td>any</td>
<td>Allow</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_src&quot;: &quot;10.0.0.2/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.3/32&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=3&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_src&quot;: &quot;10.0.0.3/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.2/32&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=4&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Added rules are registered in the switch as flow entries.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">OFPST_FLOW</span> <span class="n">reply</span> <span class="p">(</span><span class="n">OF1</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">xid</span><span class="o">=</span><span class="mh">0x2</span><span class="p">):</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x3</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">12.724</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x4</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">3.668</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">1040.802</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">420</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">65534</span><span class="p">,</span><span class="n">arp</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">759.569</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">1960</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span> <span class="n">actions</span><span class="o">=</span><span class="n">CONTROLLER</span><span class="p">:</span><span class="mi">128</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">362.147</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">335.362</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
</pre></div>
</div>
<p>Priority can be set to rules.</p>
<p>Try to add a rule to block pings (ICMP) between h3 and h2.
Set a value greater than 1, which is default value of priority.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="18%" />
<col width="18%" />
<col width="14%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">(Priority)</th>
<th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10</td>
<td>10.0.0.2/32</td>
<td>10.0.0.3/32</td>
<td>ICMP</td>
<td>Block</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>10.0.0.3/32</td>
<td>10.0.0.2/32</td>
<td>ICMP</td>
<td>Block</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d  &#39;{&quot;nw_src&quot;: &quot;10.0.0.2/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.3/32&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;, &quot;actions&quot;: &quot;DENY&quot;, &quot;priority&quot;: &quot;10&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=5&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d  &#39;{&quot;nw_src&quot;: &quot;10.0.0.3/32&quot;, &quot;nw_dst&quot;: &quot;10.0.0.2/32&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;, &quot;actions&quot;: &quot;DENY&quot;, &quot;priority&quot;: &quot;10&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=6&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Added rules are registered in the switch as flow entries.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-ofctl -O openflow13 dump-flows s1</span>
<span class="n">OFPST_FLOW</span> <span class="n">reply</span> <span class="p">(</span><span class="n">OF1</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="n">xid</span><span class="o">=</span><span class="mh">0x2</span><span class="p">):</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x3</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">242.155</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x4</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">233.099</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">1270.233</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">420</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">65534</span><span class="p">,</span><span class="n">arp</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">989</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">1960</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">0</span> <span class="n">actions</span><span class="o">=</span><span class="n">CONTROLLER</span><span class="p">:</span><span class="mi">128</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x5</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">26.984</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="n">actions</span><span class="o">=</span><span class="n">CONTROLLER</span><span class="p">:</span><span class="mi">128</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">591.578</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x6</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">14.523</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="n">actions</span><span class="o">=</span><span class="n">CONTROLLER</span><span class="p">:</span><span class="mi">128</span>
 <span class="n">cookie</span><span class="o">=</span><span class="mh">0x2</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">564.793</span><span class="n">s</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icmp</span><span class="p">,</span><span class="n">nw_src</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">,</span><span class="n">nw_dst</span><span class="o">=</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">actions</span><span class="o">=</span><span class="n">NORMAL</span>
</pre></div>
</div>
</div>
<div class="section" id="confirming-rules">
<h3>Confirming Rules<a class="headerlink" href="#confirming-rules" title="Permalink to this headline">¶</a></h3>
<p>Confirm the rules that have been set.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;access_control_list&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.3&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.3&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.3&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;DENY&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.3&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;DENY&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>The following shows the rules set.</p>
<a class="reference internal image-reference" href="_images/fig21.png"><img alt="_images/fig21.png" class="align-center" src="_images/fig21.png" style="width: 405.2px; height: 295.2px;" /></a>
<p>Try to send a ping from h1 to h2. Since rules to allow communication are set, the ping will go through.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.2</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.419</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.047</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.060</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.033</span> <span class="n">ms</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Packets from h1 to h2 other than ping are blocked by the firewall. For example, if you execute wget from h1 to h2, a log is output that packets were blocked.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># wget http://10.0.0.2</span>
<span class="o">--</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span> <span class="mi">15</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">38</span><span class="o">--</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="o">/</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span><span class="mf">80.</span><span class="o">..</span> <span class="o">^</span><span class="n">C</span>
</pre></div>
</div>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:02&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:01&#39;</span><span class="p">),</span> <span class="n">ipv4</span><span class="p">(</span><span class="n">csum</span><span class="o">=</span><span class="mi">4812</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;10.0.0.2&#39;</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">header_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">identification</span><span class="o">=</span><span class="mi">5102</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">proto</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;10.0.0.1&#39;</span><span class="p">,</span><span class="n">tos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">total_length</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">ttl</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">tcp</span><span class="p">(</span><span class="n">ack</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bits</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">45753</span><span class="p">,</span><span class="n">dst_port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x02\x04\x05\xb4\x04\x02\x08\n\x00</span><span class="s1">H:</span><span class="se">\x99\x00\x00\x00\x00\x01\x03\x03\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="mi">1021913463</span><span class="p">,</span><span class="n">src_port</span><span class="o">=</span><span class="mi">42664</span><span class="p">,</span><span class="n">urgent</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">window_size</span><span class="o">=</span><span class="mi">14600</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Between h2 and 3h, packets other than ping can communicate. For example, if you execute ssh from h2 to h3, it will not output a log that packets were blocked. (Since sshd is not operating in h3, communication by ssh will fail.)</p>
<p>host: h2:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ssh 10.0.0.3</span>
<span class="n">ssh</span><span class="p">:</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">host</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="n">port</span> <span class="mi">22</span><span class="p">:</span> <span class="n">Connection</span> <span class="n">refused</span>
</pre></div>
</div>
<p>If you execute ping from h2 to h3, a log is output that packets were blocked by the firewall.</p>
<p>host: h2:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.3</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">8</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">0</span> <span class="n">received</span><span class="p">,</span> <span class="mi">100</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">7055</span><span class="n">ms</span>
</pre></div>
</div>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:03&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:02&#39;</span><span class="p">),</span> <span class="n">ipv4</span><span class="p">(</span><span class="n">csum</span><span class="o">=</span><span class="mi">9893</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;10.0.0.3&#39;</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">header_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">identification</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">proto</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;10.0.0.2&#39;</span><span class="p">,</span><span class="n">tos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">total_length</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span><span class="n">ttl</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">icmp</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">35642</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">echo</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r\x12\xca</span><span class="s1">R</span><span class="se">\x00\x00\x00\x00\xab\x8b\t\x00\x00\x00\x00\x00\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class="s1"> !&quot;#$%&amp;</span><span class="se">\&#39;</span><span class="s1">()*+,-./01234567&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">8705</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="nb">type</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-rule">
<h3>Deleting a Rule<a class="headerlink" href="#deleting-a-rule" title="Permalink to this headline">¶</a></h3>
<p>Delete the &#8220;rule_id:5&#8221; and &#8220;rule_id:6&#8221; rules.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X DELETE -d &#39;{&quot;rule_id&quot;: &quot;5&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule deleted. : ruleID=5&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X DELETE -d &#39;{&quot;rule_id&quot;: &quot;6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule deleted. : ruleID=6&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>The following shows the current rules.</p>
<a class="reference internal image-reference" href="_images/fig31.png"><img alt="_images/fig31.png" class="align-center" src="_images/fig31.png" style="width: 405.6px; height: 295.6px;" /></a>
<p>Let&#8217;s confirm them. Since the rule to block pings (ICMP) between h2 and h3 is deleted, you can see that ping can now communicate.</p>
<p>host: h2:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.3</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.841</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.036</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.026</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.3</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.033</span> <span class="n">ms</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-of-the-operation-of-a-multi-tenant-ipv4">
<h2>Example of the Operation of a Multi-tenant (IPv4)<a class="headerlink" href="#example-of-the-operation-of-a-multi-tenant-ipv4" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating a topology where tenants are divided by VLAN such as the following and routes or addresses for each switch s1 are added or deleted and communication availability between each host is verified.</p>
<a class="reference internal image-reference" href="_images/fig4.png"><img alt="_images/fig4.png" class="align-center" src="_images/fig4.png" style="width: 399.6px; height: 355.6px;" /></a>
<div class="section" id="building-an-environment">
<h3>Building an Environment<a class="headerlink" href="#building-an-environment" title="Permalink to this headline">¶</a></h3>
<p>As with the example of Single-tenant, build an environment on Mininet and start another xterm for controller. Note that there is one more host to be used than before.</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span>ryu@ryu-vm:~$ sudo mn --topo single,4 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1 h2 h3 h4
*** Adding switches:
s1
*** Adding links:
(h1, s1) (h2, s1) (h3, s1) (h4, s1)
*** Configuring hosts
h1 h2 h3 h4
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 1 switches
s1

*** Starting CLI:
mininet&gt; xterm c0
mininet&gt;
</pre></div>
</div>
<p>Next, set the VLAN ID to the interface of each host.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del 10.0.0.1/8 dev h1-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h1-eth0 name h1-eth0.2 type vlan id 2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add 10.0.0.1/8 dev h1-eth0.2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h1-eth0.2 up</span>
</pre></div>
</div>
<p>host: h2:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del 10.0.0.2/8 dev h2-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h2-eth0 name h2-eth0.2 type vlan id 2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add 10.0.0.2/8 dev h2-eth0.2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h2-eth0.2 up</span>
</pre></div>
</div>
<p>host: h3:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del 10.0.0.3/8 dev h3-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h3-eth0 name h3-eth0.110 type vlan id 110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add 10.0.0.3/8 dev h3-eth0.110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h3-eth0.110 up</span>
</pre></div>
</div>
<p>host: h4:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del 10.0.0.4/8 dev h4-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h4-eth0 name h4-eth0.110 type vlan id 110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add 10.0.0.4/8 dev h4-eth0.110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h4-eth0.110 up</span>
</pre></div>
</div>
<p>Then, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-vsctl set Bridge s1 protocols=OpenFlow13</span>
</pre></div>
</div>
<p>Finally, start rest_firewall on an xterm of the controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ryu-manager ryu.app.rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="kc">None</span> <span class="n">of</span> <span class="n">DPSet</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">dpset</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">wsgi</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span> <span class="n">of</span> <span class="n">RestFirewallAPI</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span> <span class="n">of</span> <span class="n">OFPHandler</span>
<span class="p">(</span><span class="mi">13419</span><span class="p">)</span> <span class="n">wsgi</span> <span class="n">starting</span> <span class="n">up</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">switch_id</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Join</span> <span class="k">as</span> <span class="n">firewall</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-the-initial-state">
<h3>Changing the Initial State<a class="headerlink" href="#changing-the-initial-state" title="Permalink to this headline">¶</a></h3>
<p>Enable the firewall.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X PUT http://localhost:8080/firewall/module/enable/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall running.&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/module/status</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-rules">
<h3>Adding Rules<a class="headerlink" href="#adding-rules" title="Permalink to this headline">¶</a></h3>
<p>Add a rule to vlan_id = 2 that allows pings (ICMP packets) to be sent and received to 10.0.0.0/8. Since there is a need to set rules in both directions, add two rules.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="16%" />
<col width="16%" />
<col width="12%" />
<col width="15%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">(Priority)</th>
<th class="head">VLAN ID</th>
<th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>2</td>
<td>10.0.0.0/8</td>
<td>any</td>
<td>ICMP</td>
<td>Allow</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>2</td>
<td>any</td>
<td>10.0.0.0/8</td>
<td>ICMP</td>
<td>Allow</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_src&quot;: &quot;10.0.0.0/8&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001/2</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=1&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;nw_dst&quot;: &quot;10.0.0.0/8&quot;, &quot;nw_proto&quot;: &quot;ICMP&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001/2</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=2&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Confirming Rules<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Confirm the rules that have been set.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/rules/0000000000000001/all</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;access_control_list&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_vlan&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;nw_src&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMP&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_vlan&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Let&#8217;s confirm them. When you execute ping from h1, which is vlan_id=2, to h2 which is also vlan_id=2, you can see that it can communicate per the rules that were added.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.2</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.893</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.098</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.122</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.2</span><span class="p">:</span> <span class="n">icmp_req</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.047</span> <span class="n">ms</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Since there is no rule between h3 and h4, which are both vlan_id=110, packets are blocked.</p>
<p>host: h3:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping 10.0.0.4</span>
<span class="n">PING</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.4</span> <span class="p">(</span><span class="mf">10.0</span><span class="o">.</span><span class="mf">0.4</span><span class="p">)</span> <span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">data</span><span class="o">.</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="mf">10.0</span><span class="o">.</span><span class="mf">0.4</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">6</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">0</span> <span class="n">received</span><span class="p">,</span> <span class="mi">100</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">4999</span><span class="n">ms</span>
</pre></div>
</div>
<p>Since packets are blocked, a log is output.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:04&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">33024</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:03&#39;</span><span class="p">),</span> <span class="n">vlan</span><span class="p">(</span><span class="n">cfi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span><span class="n">pcp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vid</span><span class="o">=</span><span class="mi">110</span><span class="p">),</span> <span class="n">ipv4</span><span class="p">(</span><span class="n">csum</span><span class="o">=</span><span class="mi">9891</span><span class="p">,</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;10.0.0.4&#39;</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">header_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">identification</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">proto</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;10.0.0.3&#39;</span><span class="p">,</span><span class="n">tos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">total_length</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span><span class="n">ttl</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">icmp</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">58104</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">echo</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\xb8\xa9\xae</span><span class="s1">R</span><span class="se">\x00\x00\x00\x00\xce\xe3\x02\x00\x00\x00\x00\x00\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class="s1"> !&quot;#$%&amp;</span><span class="se">\&#39;</span><span class="s1">()*+,-./01234567&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">7760</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span><span class="nb">type</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-of-operation-of-a-single-tenant-ipv6">
<h2>Example of operation of a single tenant (IPv6)<a class="headerlink" href="#example-of-operation-of-a-single-tenant-ipv6" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating a topology where hosts are assigned with IPv6 address such as the following and routes or addresses for each switch s1 are added or deleted and communication availability between each host is verified.</p>
<a class="reference internal image-reference" href="_images/fig5.png"><img alt="_images/fig5.png" class="align-center" src="_images/fig5.png" style="width: 405.6px; height: 295.2px;" /></a>
<div class="section" id="id2">
<h3>Environment Building<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>First, build an environment on Mininet. The commands to be entered are the same as &#8220;<a class="reference internal" href="#example-of-operation-of-a-single-tenant-ipv4">Example of operation of a single tenant (IPv4)</a>&#8221;.</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span>ryu@ryu-vm:~$ sudo mn --topo single,3 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1 h2 h3
*** Adding switches:
s1
*** Adding links:
(h1, s1) (h2, s1) (h3, s1)
*** Configuring hosts
h1 h2 h3
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 1 switches
s1
*** Starting CLI:
mininet&gt;
</pre></div>
</div>
<p>Also, start another xterm for the controller.</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">mininet</span><span class="o">&gt;</span> <span class="n">xterm</span> <span class="n">c0</span>
<span class="n">mininet</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-vsctl set Bridge s1 protocols=OpenFlow13</span>
</pre></div>
</div>
<p>Finally, start rest_firewall on xterm of the controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ryu-manager ryu.app.rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="kc">None</span> <span class="n">of</span> <span class="n">DPSet</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">dpset</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">wsgi</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span> <span class="n">of</span> <span class="n">RestFirewallAPI</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span> <span class="n">of</span> <span class="n">OFPHandler</span>
<span class="p">(</span><span class="mi">2210</span><span class="p">)</span> <span class="n">wsgi</span> <span class="n">starting</span> <span class="n">up</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">switch_id</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Join</span> <span class="k">as</span> <span class="n">firewall</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>Changing the Initial State<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Enable the firewall.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X PUT http://localhost:8080/firewall/module/enable/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall running.&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/module/status</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Adding Rules<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Add rules to permit pinging between h1 and h2. You need to add rules for both ways.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="9%" />
<col width="10%" />
<col width="9%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
<th class="head">(Note)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>fe80::200:ff:fe00:1</td>
<td>fe80::200:ff:fe00:2</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>1</td>
<td>Unicast message (Echo)</td>
</tr>
<tr class="row-odd"><td>fe80::200:ff:fe00:2</td>
<td>fe80::200:ff:fe00:1</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>2</td>
<td>Unicast message (Echo)</td>
</tr>
<tr class="row-even"><td>fe80::200:ff:fe00:1</td>
<td>ff02::1:ff00:2</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>3</td>
<td>Multicast message (Neighbor Discovery)</td>
</tr>
<tr class="row-odd"><td>fe80::200:ff:fe00:2</td>
<td>ff02::1:ff00:1</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>4</td>
<td>Multicast message (Neighbor Discovery)</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:1&quot;, &quot;ipv6_dst&quot;: &quot;fe80::200:ff:fe00:2&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=1&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:2&quot;, &quot;ipv6_dst&quot;: &quot;fe80::200:ff:fe00:1&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=2&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:1&quot;, &quot;ipv6_dst&quot;: &quot;ff02::1:ff00:2&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=3&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:2&quot;, &quot;ipv6_dst&quot;: &quot;ff02::1:ff00:1&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=4&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Confirming Rules<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Confirm the rules that have been set.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/rules/0000000000000001/all</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;access_control_list&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;ipv6_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;ipv6_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;ipv6_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;ff02::1:ff00:2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;ipv6_dst&quot;</span><span class="p">:</span> <span class="s2">&quot;ff02::1:ff00:1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Let&#8217;s confirm them. When you execute ping from h1 to h2, you can see that it can communicate per the rules that were added.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping6 -I h1-eth0 fe80::200:ff:fe00:2</span>
<span class="n">PING</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">(</span><span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">h1</span><span class="o">-</span><span class="n">eth0</span><span class="p">:</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.954</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.047</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.055</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.027</span> <span class="n">ms</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Since there is no rule between h1 and h3, packets are blocked.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping6 -I h1-eth0 fe80::200:ff:fe00:3</span>
<span class="n">PING</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span><span class="p">(</span><span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">h1</span><span class="o">-</span><span class="n">eth0</span><span class="p">:</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">4</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">0</span> <span class="n">received</span><span class="p">,</span> <span class="o">+</span><span class="mi">3</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">100</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">2999</span><span class="n">ms</span>
</pre></div>
</div>
<p>Since packets are blocked, a log is output.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;33:33:ff:00:00:03&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">34525</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:01&#39;</span><span class="p">),</span> <span class="n">ipv6</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;ff02::1:ff00:3&#39;</span><span class="p">,</span><span class="n">ext_hdrs</span><span class="o">=</span><span class="p">[],</span><span class="n">flow_label</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_limit</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span><span class="n">nxt</span><span class="o">=</span><span class="mi">58</span><span class="p">,</span><span class="n">payload_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;fe80::200:ff:fe00:1&#39;</span><span class="p">,</span><span class="n">traffic_class</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">icmpv6</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">31381</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">nd_neighbor</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;fe80::200:ff:fe00:3&#39;</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="n">nd_option_sla</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hw_src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:01&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">type_</span><span class="o">=</span><span class="mi">135</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-of-the-operation-of-a-multi-tenant-ipv6">
<h2>Example of the Operation of a Multi-tenant (IPv6)<a class="headerlink" href="#example-of-the-operation-of-a-multi-tenant-ipv6" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of creating a topology where tenants are divided by VLAN and assigned with IPv6 address such as the following, routes or addresses for each switch s1 are added or deleted and communication availability between each host is verified.</p>
<a class="reference internal image-reference" href="_images/fig6.png"><img alt="_images/fig6.png" class="align-center" src="_images/fig6.png" style="width: 399.6px; height: 368.4px;" /></a>
<div class="section" id="id6">
<h3>Building an Environment<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>As with &#8220;<a class="reference internal" href="#example-of-the-operation-of-a-multi-tenant-ipv4">Example of the Operation of a Multi-tenant (IPv4)</a>&#8221;, build an environment on Mininet and start another xterm for controller.</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span>ryu@ryu-vm:~$ sudo mn --topo single,4 --mac --switch ovsk --controller remote -x
*** Creating network
*** Adding controller
Unable to contact the remote controller at 127.0.0.1:6633
*** Adding hosts:
h1 h2 h3 h4
*** Adding switches:
s1
*** Adding links:
(h1, s1) (h2, s1) (h3, s1) (h4, s1)
*** Configuring hosts
h1 h2 h3 h4
*** Running terms on localhost:10.0
*** Starting controller
*** Starting 1 switches
s1
*** Starting CLI:
mininet&gt; xterm c0
mininet&gt;
</pre></div>
</div>
<p>Next, set the VLAN ID to the interface of each host.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del fe80::200:ff:fe00:1/64 dev h1-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h1-eth0 name h1-eth0.2 type vlan id 2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add fe80::200:ff:fe00:1/64 dev h1-eth0.2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h1-eth0.2 up</span>
</pre></div>
</div>
<p>host: h2:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del fe80::200:ff:fe00:2/64 dev h2-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h2-eth0 name h2-eth0.2 type vlan id 2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add fe80::200:ff:fe00:2/64 dev h2-eth0.2</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h2-eth0.2 up</span>
</pre></div>
</div>
<p>host: h3:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del fe80::200:ff:fe00:3/64 dev h3-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h3-eth0 name h3-eth0.110 type vlan id 110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add fe80::200:ff:fe00:3/64 dev h3-eth0.110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h3-eth0.110 up</span>
</pre></div>
</div>
<p>host: h4:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr del fe80::200:ff:fe00:4/64 dev h4-eth0</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link add link h4-eth0 name h4-eth0.110 type vlan id 110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip addr add fe80::200:ff:fe00:4/64 dev h4-eth0.110</span>
<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ip link set dev h4-eth0.110 up</span>
</pre></div>
</div>
<p>Then, set the version of OpenFlow to be used in each router to 1.3.</p>
<p>switch: s1 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ovs-vsctl set Bridge s1 protocols=OpenFlow13</span>
</pre></div>
</div>
<p>Finally, start rest_firewall on an xterm of the controller.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ryu-manager ryu.app.rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span>
<span class="n">loading</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="kc">None</span> <span class="n">of</span> <span class="n">DPSet</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">dpset</span>
<span class="n">creating</span> <span class="n">context</span> <span class="n">wsgi</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">rest_firewall</span> <span class="n">of</span> <span class="n">RestFirewallAPI</span>
<span class="n">instantiating</span> <span class="n">app</span> <span class="n">ryu</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">ofp_handler</span> <span class="n">of</span> <span class="n">OFPHandler</span>
<span class="p">(</span><span class="mi">13419</span><span class="p">)</span> <span class="n">wsgi</span> <span class="n">starting</span> <span class="n">up</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
</pre></div>
</div>
<p>After a successful connection between the router and Ryu, the following message appears.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">switch_id</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Join</span> <span class="k">as</span> <span class="n">firewall</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>Changing the Initial State<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Enable the firewall.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X PUT http://localhost:8080/firewall/module/enable/0000000000000001</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;firewall running.&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/module/status</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;enable&quot;</span><span class="p">,</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>Adding Rules<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Add a rule to vlan_id = 2 that allows pings (ICMPv6 packets) to be sent and received to fe80::/64. Since there is a need to set rules in both directions, add two rules.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="24%" />
<col width="15%" />
<col width="11%" />
<col width="14%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">(Priority)</th>
<th class="head">VLAN ID</th>
<th class="head">Source</th>
<th class="head">Destination</th>
<th class="head">Protocol</th>
<th class="head">Permission</th>
<th class="head">(Rule ID)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>2</td>
<td>fe80::200:ff:fe00:1</td>
<td>any</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>2</td>
<td>fe80::200:ff:fe00:2</td>
<td>any</td>
<td>ICMPv6</td>
<td>Allow</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:1&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001/2</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=1&quot;</span><span class="p">,</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>

<span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X POST -d &#39;{&quot;ipv6_src&quot;: &quot;fe80::200:ff:fe00:2&quot;, &quot;nw_proto&quot;: &quot;ICMPv6&quot;}&#39; http://localhost:8080/firewall/rules/0000000000000001/2</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;command_result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Rule added. : rule_id=2&quot;</span><span class="p">,</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>Confirming Rules<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Confirm the rules that have been set.</p>
<p>Node: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl http://localhost:8080/firewall/rules/0000000000000001/all</span>
  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;switch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000001&quot;</span><span class="p">,</span>
      <span class="s2">&quot;access_control_list&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;vlan_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
          <span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="s2">&quot;dl_vlan&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:1&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="s2">&quot;ALLOW&quot;</span><span class="p">,</span>
              <span class="s2">&quot;rule_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
              <span class="s2">&quot;dl_vlan&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;ipv6_src&quot;</span><span class="p">:</span> <span class="s2">&quot;fe80::200:ff:fe00:2&quot;</span><span class="p">,</span>
              <span class="s2">&quot;nw_proto&quot;</span><span class="p">:</span> <span class="s2">&quot;ICMPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;dl_type&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
              <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Let&#8217;s confirm them. When you execute ping from h1, which is vlan_id=2, to h2 which is also vlan_id=2, you can see that it can communicate per the rules that were added.</p>
<p>host: h1:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping6 -I h1-eth0.2 fe80::200:ff:fe00:2</span>
<span class="n">PING</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">(</span><span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">1</span> <span class="n">h1</span><span class="o">-</span><span class="n">eth0</span><span class="o">.</span><span class="mi">2</span><span class="p">:</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.609</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.046</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.046</span> <span class="n">ms</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">4</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.057</span> <span class="n">ms</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Since there is no rule between h3 and h4, which are both vlan_id=110, packets are blocked.</p>
<p>host: h3:</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ryu</span><span class="o">-</span><span class="n">vm</span><span class="p">:</span><span class="o">~</span><span class="c1"># ping6 -I h3-eth0.110 fe80::200:ff:fe00:4</span>
<span class="n">PING</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">4</span><span class="p">(</span><span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span> <span class="n">h3</span><span class="o">-</span><span class="n">eth0</span><span class="o">.</span><span class="mi">110</span><span class="p">:</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">2</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="n">From</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">3</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">3</span> <span class="n">Destination</span> <span class="n">unreachable</span><span class="p">:</span> <span class="n">Address</span> <span class="n">unreachable</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">200</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">fe00</span><span class="p">:</span><span class="mi">4</span> <span class="n">ping</span> <span class="n">statistics</span> <span class="o">---</span>
<span class="mi">4</span> <span class="n">packets</span> <span class="n">transmitted</span><span class="p">,</span> <span class="mi">0</span> <span class="n">received</span><span class="p">,</span> <span class="o">+</span><span class="mi">3</span> <span class="n">errors</span><span class="p">,</span> <span class="mi">100</span><span class="o">%</span> <span class="n">packet</span> <span class="n">loss</span><span class="p">,</span> <span class="n">time</span> <span class="mi">3014</span><span class="n">ms</span>
</pre></div>
</div>
<p>Since packets are blocked, a log is output.</p>
<p>controller: c0 (root):</p>
<div class="console highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FW</span><span class="p">][</span><span class="n">INFO</span><span class="p">]</span> <span class="n">dpid</span><span class="o">=</span><span class="mi">0000000000000001</span><span class="p">:</span> <span class="n">Blocked</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;33:33:ff:00:00:04&#39;</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">33024</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:03&#39;</span><span class="p">),</span> <span class="n">vlan</span><span class="p">(</span><span class="n">cfi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ethertype</span><span class="o">=</span><span class="mi">34525</span><span class="p">,</span><span class="n">pcp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vid</span><span class="o">=</span><span class="mi">110</span><span class="p">),</span> <span class="n">ipv6</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;ff02::1:ff00:4&#39;</span><span class="p">,</span><span class="n">ext_hdrs</span><span class="o">=</span><span class="p">[],</span><span class="n">flow_label</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_limit</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span><span class="n">nxt</span><span class="o">=</span><span class="mi">58</span><span class="p">,</span><span class="n">payload_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;fe80::200:ff:fe00:3&#39;</span><span class="p">,</span><span class="n">traffic_class</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">version</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">icmpv6</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">csum</span><span class="o">=</span><span class="mi">31375</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">nd_neighbor</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;fe80::200:ff:fe00:4&#39;</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="n">nd_option_sla</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hw_src</span><span class="o">=</span><span class="s1">&#39;00:00:00:00:00:03&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">type_</span><span class="o">=</span><span class="mi">135</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>In this section, you learned how to use the firewall with specific examples.</p>
</div>
</div>
<div class="section" id="rest-api-list">
<h2>REST API List<a class="headerlink" href="#rest-api-list" title="Permalink to this headline">¶</a></h2>
<p>List of REST API of rest_firewall, which is introduced in this section.</p>
<div class="section" id="acquiring-enable-disable-state-of-all-switches">
<h3>Acquiring Enable/Disable State of All Switches<a class="headerlink" href="#acquiring-enable-disable-state-of-all-switches" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>GET</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td>/firewall/module/status</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="changing-enable-disable-state-of-all-switches">
<h3>Changing Enable/Disable State of All Switches<a class="headerlink" href="#changing-enable-disable-state-of-all-switches" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>PUT</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/firewall/module/{<strong>op</strong>}/{<strong>switch</strong>}</p>
<p>&#8211;<strong>op</strong>: [ &#8220;enable&#8221; | &#8220;disable&#8221; ]</p>
<p class="last">&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Remarks</strong></td>
<td>Initial state of each switch is &#8220;disable&#8221;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="acquiring-all-rules">
<h3>Acquiring All Rules<a class="headerlink" href="#acquiring-all-rules" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>GET</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/firewall/rules/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id10">
<h3>Adding Rules<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>POST</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/firewall/rules/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><p class="first"><strong>priority</strong>:[ 0 - 65535 ]</p>
<p><strong>in_port</strong>:[ 0 - 65535 ]</p>
<p><strong>dl_src</strong>:&#8221;&lt;xx:xx:xx:xx:xx:xx&gt;&#8221;</p>
<p><strong>dl_dst</strong>:&#8221;&lt;xx:xx:xx:xx:xx:xx&gt;&#8221;</p>
<p><strong>dl_type</strong>:[ &#8220;ARP&#8221; | &#8220;IPv4&#8221; | &#8220;IPv6&#8221; ]</p>
<p><strong>nw_src</strong>:&#8221;&lt;xxx.xxx.xxx.xxx/xx&gt;&#8221;</p>
<p><strong>nw_dst</strong>:&#8221;&lt;xxx.xxx.xxx.xxx/xx&gt;&#8221;</p>
<p><strong>ipv6_src</strong>:&#8221;&lt;xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx/xx&gt;&#8221;</p>
<p><strong>ipv6_dst</strong>:&#8221;&lt;xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx/xx&gt;&#8221;</p>
<p><strong>nw_proto</strong>&#8221;:[ &#8220;TCP&#8221; | &#8220;UDP&#8221; | &#8220;ICMP&#8221; | &#8220;ICMPv6&#8221; ]</p>
<p><strong>tp_src</strong>:[ 0 - 65535 ]</p>
<p><strong>tp_dst</strong>:[ 0 - 65535 ]</p>
<p class="last"><strong>actions</strong>: [ &#8220;ALLOW&#8221; | &#8220;DENY&#8221; ]</p>
</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td><p class="first">When it is successfully registered, Rule ID is generated and is noted in the response.</p>
<p class="last">Specification of VLAN ID is optional.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="deleting-rules">
<h3>Deleting Rules<a class="headerlink" href="#deleting-rules" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>DELETE</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/firewall/rules/{<strong>switch</strong>}[/{<strong>vlan</strong>}]</p>
<p>&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
<p class="last">&#8211;<strong>vlan</strong>: [ &#8220;all&#8221; | <em>VLAN ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Data</strong></td>
<td><strong>rule_id</strong>:[ &#8220;all&#8221; | 1 - ... ]</td>
</tr>
<tr class="row-even"><td><strong>Remarks</strong></td>
<td>Specification of VLAN ID is optional.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="acquiring-log-output-state-of-all-switches">
<h3>Acquiring Log Output State of All Switches<a class="headerlink" href="#acquiring-log-output-state-of-all-switches" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>GET</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td>/firewall/log/status</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="changing-log-output-state-of-all-switches">
<h3>Changing Log Output State of All Switches<a class="headerlink" href="#changing-log-output-state-of-all-switches" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Method</strong></td>
<td>PUT</td>
</tr>
<tr class="row-even"><td><strong>URL</strong></td>
<td><p class="first">/firewall/log/{<strong>op</strong>}/{<strong>switch</strong>}</p>
<p>&#8211;<strong>op</strong>: [ &#8220;enable&#8221; | &#8220;disable&#8221; ]</p>
<p class="last">&#8211;<strong>switch</strong>: [ &#8220;all&#8221; | <em>Switch ID</em> ]</p>
</td>
</tr>
<tr class="row-odd"><td><strong>Remarks</strong></td>
<td>Initial state of each switch is &#8220;enable&#8221;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Firewall</a><ul>
<li><a class="reference internal" href="#example-of-operation-of-a-single-tenant-ipv4">Example of operation of a single tenant (IPv4)</a><ul>
<li><a class="reference internal" href="#environment-building">Environment Building</a></li>
<li><a class="reference internal" href="#changing-in-the-initial-state">Changing in the initial state</a></li>
<li><a class="reference internal" href="#adding-a-rule">Adding a Rule</a></li>
<li><a class="reference internal" href="#confirming-rules">Confirming Rules</a></li>
<li><a class="reference internal" href="#deleting-a-rule">Deleting a Rule</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-the-operation-of-a-multi-tenant-ipv4">Example of the Operation of a Multi-tenant (IPv4)</a><ul>
<li><a class="reference internal" href="#building-an-environment">Building an Environment</a></li>
<li><a class="reference internal" href="#changing-the-initial-state">Changing the Initial State</a></li>
<li><a class="reference internal" href="#adding-rules">Adding Rules</a></li>
<li><a class="reference internal" href="#id1">Confirming Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-operation-of-a-single-tenant-ipv6">Example of operation of a single tenant (IPv6)</a><ul>
<li><a class="reference internal" href="#id2">Environment Building</a></li>
<li><a class="reference internal" href="#id3">Changing the Initial State</a></li>
<li><a class="reference internal" href="#id4">Adding Rules</a></li>
<li><a class="reference internal" href="#id5">Confirming Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-the-operation-of-a-multi-tenant-ipv6">Example of the Operation of a Multi-tenant (IPv6)</a><ul>
<li><a class="reference internal" href="#id6">Building an Environment</a></li>
<li><a class="reference internal" href="#id7">Changing the Initial State</a></li>
<li><a class="reference internal" href="#id8">Adding Rules</a></li>
<li><a class="reference internal" href="#id9">Confirming Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rest-api-list">REST API List</a><ul>
<li><a class="reference internal" href="#acquiring-enable-disable-state-of-all-switches">Acquiring Enable/Disable State of All Switches</a></li>
<li><a class="reference internal" href="#changing-enable-disable-state-of-all-switches">Changing Enable/Disable State of All Switches</a></li>
<li><a class="reference internal" href="#acquiring-all-rules">Acquiring All Rules</a></li>
<li><a class="reference internal" href="#id10">Adding Rules</a></li>
<li><a class="reference internal" href="#deleting-rules">Deleting Rules</a></li>
<li><a class="reference internal" href="#acquiring-log-output-state-of-all-switches">Acquiring Log Output State of All Switches</a></li>
<li><a class="reference internal" href="#changing-log-output-state-of-all-switches">Changing Log Output State of All Switches</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="of_config.html"
                        title="previous chapter">OF-Config Library</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rest_router.html"
                        title="next chapter">Router</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/rest_firewall.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rest_router.html" title="Router"
             >next</a> |</li>
        <li class="right" >
          <a href="of_config.html" title="OF-Config Library"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Ryubook 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, RYU project team.
    </div>
  </body>
</html>